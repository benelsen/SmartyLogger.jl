FROM julia:1.1
# 1.1 not available for armv7

WORKDIR /usr/logger/
ENV JULIA_PROJECT=/usr/logger

RUN julia -e 'using Pkg; pkg"up"'

COPY Manifest.toml /usr/logger/Manifest.toml
COPY Project.toml /usr/logger/Project.toml

RUN julia -e 'using Pkg; pkg"activate ."'
RUN julia -e 'using Pkg; pkg"instantiate"'
RUN julia -e 'using Pkg; pkg"precompile"'

COPY src/*.jl /usr/logger/src/

COPY wait-for-it.sh /usr/logger/wait-for-it.sh

CMD ["julia", "-v"]
